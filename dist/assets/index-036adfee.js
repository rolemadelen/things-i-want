function Gt(i,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const n in r)if(n!=="default"&&!(n in i)){const s=Object.getOwnPropertyDescriptor(r,n);s&&Object.defineProperty(i,n,s.get?s:{enumerable:!0,get:()=>r[n]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=t(n);fetch(n.href,s)}})();function fe(){}function jt(i){return i()}function st(){return Object.create(null)}function Ee(i){i.forEach(jt)}function At(i){return typeof i=="function"}function Kt(i,e){return i!=i?e==e:i!==e||i&&typeof i=="object"||typeof i=="function"}let ye;function nt(i,e){return ye||(ye=document.createElement("a")),ye.href=e,i===ye.href}function Vt(i){return Object.keys(i).length===0}function R(i,e){i.appendChild(e)}function Xe(i,e,t){i.insertBefore(e,t||null)}function $e(i){i.parentNode&&i.parentNode.removeChild(i)}function ot(i,e){for(let t=0;t<i.length;t+=1)i[t]&&i[t].d(e)}function N(i){return document.createElement(i)}function ke(i){return document.createTextNode(i)}function ce(){return ke(" ")}function Wt(i,e,t,r){return i.addEventListener(e,t,r),()=>i.removeEventListener(e,t,r)}function C(i,e,t){t==null?i.removeAttribute(e):i.getAttribute(e)!==t&&i.setAttribute(e,t)}function Xt(i){return Array.from(i.childNodes)}function xt(i,e){e=""+e,i.data!==e&&(i.data=e)}let pe;function he(i){pe=i}function Qt(){if(!pe)throw new Error("Function called outside component initialization");return pe}function Zt(i){Qt().$$.on_mount.push(i)}const te=[],qe=[];let ie=[];const at=[],Yt=Promise.resolve();let Je=!1;function er(){Je||(Je=!0,Yt.then(Pt))}function He(i){ie.push(i)}const Ie=new Set;let Z=0;function Pt(){if(Z!==0)return;const i=pe;do{try{for(;Z<te.length;){const e=te[Z];Z++,he(e),tr(e.$$)}}catch(e){throw te.length=0,Z=0,e}for(he(null),te.length=0,Z=0;qe.length;)qe.pop()();for(let e=0;e<ie.length;e+=1){const t=ie[e];Ie.has(t)||(Ie.add(t),t())}ie.length=0}while(te.length);for(;at.length;)at.pop()();Je=!1,Ie.clear(),he(i)}function tr(i){if(i.fragment!==null){i.update(),Ee(i.before_update);const e=i.dirty;i.dirty=[-1],i.fragment&&i.fragment.p(i.ctx,e),i.after_update.forEach(He)}}function rr(i){const e=[],t=[];ie.forEach(r=>i.indexOf(r)===-1?e.push(r):t.push(r)),t.forEach(r=>r()),ie=e}const ir=new Set;function sr(i,e){i&&i.i&&(ir.delete(i),i.i(e))}function nr(i,e,t,r){const{fragment:n,after_update:s}=i.$$;n&&n.m(e,t),r||He(()=>{const o=i.$$.on_mount.map(jt).filter(At);i.$$.on_destroy?i.$$.on_destroy.push(...o):Ee(o),i.$$.on_mount=[]}),s.forEach(He)}function or(i,e){const t=i.$$;t.fragment!==null&&(rr(t.after_update),Ee(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function ar(i,e){i.$$.dirty[0]===-1&&(te.push(i),er(),i.$$.dirty.fill(0)),i.$$.dirty[e/31|0]|=1<<e%31}function lr(i,e,t,r,n,s,o,a=[-1]){const h=pe;he(i);const c=i.$$={fragment:null,ctx:[],props:s,update:fe,not_equal:n,bound:st(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(h?h.$$.context:[])),callbacks:st(),dirty:a,skip_bound:!1,root:e.target||h.$$.root};o&&o(c.root);let l=!1;if(c.ctx=t?t(i,e.props||{},(u,f,...v)=>{const _=v.length?v[0]:f;return c.ctx&&n(c.ctx[u],c.ctx[u]=_)&&(!c.skip_bound&&c.bound[u]&&c.bound[u](_),l&&ar(i,u)),f}):[],c.update(),l=!0,Ee(c.before_update),c.fragment=r?r(c.ctx):!1,e.target){if(e.hydrate){const u=Xt(e.target);c.fragment&&c.fragment.l(u),u.forEach($e)}else c.fragment&&c.fragment.c();e.intro&&sr(i.$$.fragment),nr(i,e.target,e.anchor,e.customElement),Pt()}he(h)}class cr{$destroy(){or(this,1),this.$destroy=fe}$on(e,t){if(!At(t))return fe;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{const n=r.indexOf(t);n!==-1&&r.splice(n,1)}}$set(e){this.$$set&&!Vt(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const hr="modulepreload",ur=function(i){return"/"+i},lt={},je=function(e,t,r){if(!t||t.length===0)return e();const n=document.getElementsByTagName("link");return Promise.all(t.map(s=>{if(s=ur(s),s in lt)return;lt[s]=!0;const o=s.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let l=n.length-1;l>=0;l--){const u=n[l];if(u.href===s&&(!o||u.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":hr,o||(c.as="script",c.crossOrigin=""),c.href=s,document.head.appendChild(c),o)return new Promise((l,u)=>{c.addEventListener("load",l),c.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e())};var dr=globalThis&&globalThis.__awaiter||function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(l){try{c(r.next(l))}catch(u){o(u)}}function h(l){try{c(r.throw(l))}catch(u){o(u)}}function c(l){l.done?s(l.value):n(l.value).then(a,h)}c((r=r.apply(i,e||[])).next())})};const fr=i=>{let e;return i?e=i:typeof fetch>"u"?e=(...t)=>dr(void 0,void 0,void 0,function*(){return yield(yield je(()=>Promise.resolve().then(()=>Ae),void 0)).fetch(...t)}):e=fetch,(...t)=>e(...t)};class Qe extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class pr extends Qe{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class vr extends Qe{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class gr extends Qe{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var _r=globalThis&&globalThis.__awaiter||function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(l){try{c(r.next(l))}catch(u){o(u)}}function h(l){try{c(r.throw(l))}catch(u){o(u)}}function c(l){l.done?s(l.value):n(l.value).then(a,h)}c((r=r.apply(i,e||[])).next())})};class yr{constructor(e,{headers:t={},customFetch:r}={}){this.url=e,this.headers=t,this.fetch=fr(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return _r(this,void 0,void 0,function*(){try{const{headers:n,method:s,body:o}=t;let a={},h;o&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",h=o):typeof o=="string"?(a["Content-Type"]="text/plain",h=o):typeof FormData<"u"&&o instanceof FormData?h=o:(a["Content-Type"]="application/json",h=JSON.stringify(o)));const c=yield this.fetch(`${this.url}/${e}`,{method:s||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),n),body:h}).catch(v=>{throw new pr(v)}),l=c.headers.get("x-relay-error");if(l&&l==="true")throw new vr(c);if(!c.ok)throw new gr(c);let u=((r=c.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),f;return u==="application/json"?f=yield c.json():u==="application/octet-stream"?f=yield c.blob():u==="multipart/form-data"?f=yield c.formData():f=yield c.text(),{data:f,error:null}}catch(n){return{data:null,error:n}}})}}var mr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function br(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var ze={exports:{}};(function(i,e){var t=typeof self<"u"?self:mr,r=function(){function s(){this.fetch=!1,this.DOMException=t.DOMException}return s.prototype=t,new s}();(function(s){(function(o){var a={searchParams:"URLSearchParams"in s,iterable:"Symbol"in s&&"iterator"in Symbol,blob:"FileReader"in s&&"Blob"in s&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in s,arrayBuffer:"ArrayBuffer"in s};function h(d){return d&&DataView.prototype.isPrototypeOf(d)}if(a.arrayBuffer)var c=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],l=ArrayBuffer.isView||function(d){return d&&c.indexOf(Object.prototype.toString.call(d))>-1};function u(d){if(typeof d!="string"&&(d=String(d)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(d))throw new TypeError("Invalid character in header field name");return d.toLowerCase()}function f(d){return typeof d!="string"&&(d=String(d)),d}function v(d){var p={next:function(){var w=d.shift();return{done:w===void 0,value:w}}};return a.iterable&&(p[Symbol.iterator]=function(){return p}),p}function _(d){this.map={},d instanceof _?d.forEach(function(p,w){this.append(w,p)},this):Array.isArray(d)?d.forEach(function(p){this.append(p[0],p[1])},this):d&&Object.getOwnPropertyNames(d).forEach(function(p){this.append(p,d[p])},this)}_.prototype.append=function(d,p){d=u(d),p=f(p);var w=this.map[d];this.map[d]=w?w+", "+p:p},_.prototype.delete=function(d){delete this.map[u(d)]},_.prototype.get=function(d){return d=u(d),this.has(d)?this.map[d]:null},_.prototype.has=function(d){return this.map.hasOwnProperty(u(d))},_.prototype.set=function(d,p){this.map[u(d)]=f(p)},_.prototype.forEach=function(d,p){for(var w in this.map)this.map.hasOwnProperty(w)&&d.call(p,this.map[w],w,this)},_.prototype.keys=function(){var d=[];return this.forEach(function(p,w){d.push(w)}),v(d)},_.prototype.values=function(){var d=[];return this.forEach(function(p){d.push(p)}),v(d)},_.prototype.entries=function(){var d=[];return this.forEach(function(p,w){d.push([w,p])}),v(d)},a.iterable&&(_.prototype[Symbol.iterator]=_.prototype.entries);function y(d){if(d.bodyUsed)return Promise.reject(new TypeError("Already read"));d.bodyUsed=!0}function g(d){return new Promise(function(p,w){d.onload=function(){p(d.result)},d.onerror=function(){w(d.error)}})}function O(d){var p=new FileReader,w=g(p);return p.readAsArrayBuffer(d),w}function m(d){var p=new FileReader,w=g(p);return p.readAsText(d),w}function $(d){for(var p=new Uint8Array(d),w=new Array(p.length),x=0;x<p.length;x++)w[x]=String.fromCharCode(p[x]);return w.join("")}function A(d){if(d.slice)return d.slice(0);var p=new Uint8Array(d.byteLength);return p.set(new Uint8Array(d)),p.buffer}function z(){return this.bodyUsed=!1,this._initBody=function(d){this._bodyInit=d,d?typeof d=="string"?this._bodyText=d:a.blob&&Blob.prototype.isPrototypeOf(d)?this._bodyBlob=d:a.formData&&FormData.prototype.isPrototypeOf(d)?this._bodyFormData=d:a.searchParams&&URLSearchParams.prototype.isPrototypeOf(d)?this._bodyText=d.toString():a.arrayBuffer&&a.blob&&h(d)?(this._bodyArrayBuffer=A(d.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):a.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(d)||l(d))?this._bodyArrayBuffer=A(d):this._bodyText=d=Object.prototype.toString.call(d):this._bodyText="",this.headers.get("content-type")||(typeof d=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):a.searchParams&&URLSearchParams.prototype.isPrototypeOf(d)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},a.blob&&(this.blob=function(){var d=y(this);if(d)return d;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?y(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(O)}),this.text=function(){var d=y(this);if(d)return d;if(this._bodyBlob)return m(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve($(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},a.formData&&(this.formData=function(){return this.text().then(Jt)}),this.json=function(){return this.text().then(JSON.parse)},this}var Mt=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function qt(d){var p=d.toUpperCase();return Mt.indexOf(p)>-1?p:d}function G(d,p){p=p||{};var w=p.body;if(d instanceof G){if(d.bodyUsed)throw new TypeError("Already read");this.url=d.url,this.credentials=d.credentials,p.headers||(this.headers=new _(d.headers)),this.method=d.method,this.mode=d.mode,this.signal=d.signal,!w&&d._bodyInit!=null&&(w=d._bodyInit,d.bodyUsed=!0)}else this.url=String(d);if(this.credentials=p.credentials||this.credentials||"same-origin",(p.headers||!this.headers)&&(this.headers=new _(p.headers)),this.method=qt(p.method||this.method||"GET"),this.mode=p.mode||this.mode||null,this.signal=p.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&w)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(w)}G.prototype.clone=function(){return new G(this,{body:this._bodyInit})};function Jt(d){var p=new FormData;return d.trim().split("&").forEach(function(w){if(w){var x=w.split("="),j=x.shift().replace(/\+/g," "),k=x.join("=").replace(/\+/g," ");p.append(decodeURIComponent(j),decodeURIComponent(k))}}),p}function Ht(d){var p=new _,w=d.replace(/\r?\n[\t ]+/g," ");return w.split(/\r?\n/).forEach(function(x){var j=x.split(":"),k=j.shift().trim();if(k){var _e=j.join(":").trim();p.append(k,_e)}}),p}z.call(G.prototype);function F(d,p){p||(p={}),this.type="default",this.status=p.status===void 0?200:p.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in p?p.statusText:"OK",this.headers=new _(p.headers),this.url=p.url||"",this._initBody(d)}z.call(F.prototype),F.prototype.clone=function(){return new F(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new _(this.headers),url:this.url})},F.error=function(){var d=new F(null,{status:0,statusText:""});return d.type="error",d};var zt=[301,302,303,307,308];F.redirect=function(d,p){if(zt.indexOf(p)===-1)throw new RangeError("Invalid status code");return new F(null,{status:p,headers:{location:d}})},o.DOMException=s.DOMException;try{new o.DOMException}catch{o.DOMException=function(p,w){this.message=p,this.name=w;var x=Error(p);this.stack=x.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function Re(d,p){return new Promise(function(w,x){var j=new G(d,p);if(j.signal&&j.signal.aborted)return x(new o.DOMException("Aborted","AbortError"));var k=new XMLHttpRequest;function _e(){k.abort()}k.onload=function(){var oe={status:k.status,statusText:k.statusText,headers:Ht(k.getAllResponseHeaders()||"")};oe.url="responseURL"in k?k.responseURL:oe.headers.get("X-Request-URL");var Ce="response"in k?k.response:k.responseText;w(new F(Ce,oe))},k.onerror=function(){x(new TypeError("Network request failed"))},k.ontimeout=function(){x(new TypeError("Network request failed"))},k.onabort=function(){x(new o.DOMException("Aborted","AbortError"))},k.open(j.method,j.url,!0),j.credentials==="include"?k.withCredentials=!0:j.credentials==="omit"&&(k.withCredentials=!1),"responseType"in k&&a.blob&&(k.responseType="blob"),j.headers.forEach(function(oe,Ce){k.setRequestHeader(Ce,oe)}),j.signal&&(j.signal.addEventListener("abort",_e),k.onreadystatechange=function(){k.readyState===4&&j.signal.removeEventListener("abort",_e)}),k.send(typeof j._bodyInit>"u"?null:j._bodyInit)})}return Re.polyfill=!0,s.fetch||(s.fetch=Re,s.Headers=_,s.Request=G,s.Response=F),o.Headers=_,o.Request=G,o.Response=F,o.fetch=Re,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(r),r.fetch.ponyfill=!0,delete r.fetch.polyfill;var n=r;e=n.fetch,e.default=n.fetch,e.fetch=n.fetch,e.Headers=n.Headers,e.Request=n.Request,e.Response=n.Response,i.exports=e})(ze,ze.exports);var Ze=ze.exports;const Ye=br(Ze),Ae=Gt({__proto__:null,default:Ye},[Ze]);class wr{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=Ye:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const r=this.fetch;let n=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async s=>{var o,a,h;let c=null,l=null,u=null,f=s.status,v=s.statusText;if(s.ok){if(this.method!=="HEAD"){const O=await s.text();O===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?l=O:l=JSON.parse(O))}const y=(o=this.headers.Prefer)===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),g=(a=s.headers.get("content-range"))===null||a===void 0?void 0:a.split("/");y&&g&&g.length>1&&(u=parseInt(g[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(l)&&(l.length>1?(c={code:"PGRST116",details:`Results contain ${l.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},l=null,u=null,f=406,v="Not Acceptable"):l.length===1?l=l[0]:l=null)}else{const y=await s.text();try{c=JSON.parse(y),Array.isArray(c)&&s.status===404&&(l=[],c=null,f=200,v="OK")}catch{s.status===404&&y===""?(f=204,v="No Content"):c={message:y}}if(c&&this.isMaybeSingle&&(!((h=c==null?void 0:c.details)===null||h===void 0)&&h.includes("Results contain 0 rows"))&&(c=null,f=200,v="OK"),c&&this.shouldThrowOnError)throw c}return{error:c,data:l,count:u,status:f,statusText:v}});return this.shouldThrowOnError||(n=n.catch(s=>{var o,a,h;return{error:{message:`${(o=s==null?void 0:s.name)!==null&&o!==void 0?o:"FetchError"}: ${s==null?void 0:s.message}`,details:`${(a=s==null?void 0:s.stack)!==null&&a!==void 0?a:""}`,hint:"",code:`${(h=s==null?void 0:s.code)!==null&&h!==void 0?h:""}`},data:null,count:null,status:0,statusText:""}})),n.then(e,t)}}class Tr extends wr{select(e){let t=!1;const r=(e??"*").split("").map(n=>/\s/.test(n)&&!t?"":(n==='"'&&(t=!t),n)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:n}={}){const s=n?`${n}.order`:"order",o=this.url.searchParams.get(s);return this.url.searchParams.set(s,`${o?`${o},`:""}${e}.${t?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t}={}){const r=typeof t>"u"?"limit":`${t}.limit`;return this.url.searchParams.set(r,`${e}`),this}range(e,t,{foreignTable:r}={}){const n=typeof r>"u"?"offset":`${r}.offset`,s=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(n,`${e}`),this.url.searchParams.set(s,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:n=!1,wal:s=!1,format:o="text"}={}){const a=[e?"analyze":null,t?"verbose":null,r?"settings":null,n?"buffers":null,s?"wal":null].filter(Boolean).join("|"),h=this.headers.Accept;return this.headers.Accept=`application/vnd.pgrst.plan+${o}; for="${h}"; options=${a};`,o==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}class re extends Tr{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=t.map(n=>typeof n=="string"&&new RegExp("[,()]").test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:n}={}){let s="";n==="plain"?s="pl":n==="phrase"?s="ph":n==="websearch"&&(s="w");const o=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${s}fts${o}.${t}`),this}match(e){return Object.entries(e).forEach(([t,r])=>{this.url.searchParams.append(t,`eq.${r}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t}={}){const r=t?`${t}.or`:"or";return this.url.searchParams.append(r,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}}class Sr{constructor(e,{headers:t={},schema:r,fetch:n}){this.url=e,this.headers=t,this.schema=r,this.fetch=n}select(e,{head:t=!1,count:r}={}){const n=t?"HEAD":"GET";let s=!1;const o=(e??"*").split("").map(a=>/\s/.test(a)&&!s?"":(a==='"'&&(s=!s),a)).join("");return this.url.searchParams.set("select",o),r&&(this.headers.Prefer=`count=${r}`),new re({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:r=!0}={}){const n="POST",s=[];if(this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),r||s.push("missing=default"),this.headers.Prefer=s.join(","),Array.isArray(e)){const o=e.reduce((a,h)=>a.concat(Object.keys(h)),[]);if(o.length>0){const a=[...new Set(o)].map(h=>`"${h}"`);this.url.searchParams.set("columns",a.join(","))}}return new re({method:n,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:n,defaultToNull:s=!0}={}){const o="POST",a=[`resolution=${r?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&a.push(this.headers.Prefer),n&&a.push(`count=${n}`),s||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(e)){const h=e.reduce((c,l)=>c.concat(Object.keys(l)),[]);if(h.length>0){const c=[...new Set(h)].map(l=>`"${l}"`);this.url.searchParams.set("columns",c.join(","))}}return new re({method:o,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const r="PATCH",n=[];return this.headers.Prefer&&n.push(this.headers.Prefer),t&&n.push(`count=${t}`),this.headers.Prefer=n.join(","),new re({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",r=[];return e&&r.push(`count=${e}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new re({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}const Or="1.7.1",kr={"X-Client-Info":`postgrest-js/${Or}`};class Er{constructor(e,{headers:t={},schema:r,fetch:n}={}){this.url=e,this.headers=Object.assign(Object.assign({},kr),t),this.schema=r,this.fetch=n}from(e){const t=new URL(`${this.url}/${e}`);return new Sr(t,{headers:Object.assign({},this.headers),schema:this.schema,fetch:this.fetch})}rpc(e,t={},{head:r=!1,count:n}={}){let s;const o=new URL(`${this.url}/rpc/${e}`);let a;r?(s="HEAD",Object.entries(t).forEach(([c,l])=>{o.searchParams.append(c,`${l}`)})):(s="POST",a=t);const h=Object.assign({},this.headers);return n&&(h.Prefer=`count=${n}`),new re({method:s,url:o,headers:h,schema:this.schema,body:a,fetch:this.fetch,allowEmpty:!1})}}var De,ct;function $r(){if(ct)return De;ct=1;var i=function(){if(typeof self=="object"&&self)return self;if(typeof window=="object"&&window)return window;throw new Error("Unable to resolve global `this`")};return De=function(){if(this)return this;if(typeof globalThis=="object"&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch{return i()}try{return __global__||i()}finally{delete Object.prototype.__global__}}(),De}const jr="websocket",Ar="Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",xr=["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],Pr="Brian McKelvey <theturtle32@gmail.com> (https://github.com/theturtle32)",Rr=["Iñaki Baz Castillo <ibc@aliax.net> (http://dev.sipdoc.net)"],Cr="1.0.34",Ir={type:"git",url:"https://github.com/theturtle32/WebSocket-Node.git"},Dr="https://github.com/theturtle32/WebSocket-Node",Ur={node:">=4.0.0"},Lr={bufferutil:"^4.0.1",debug:"^2.2.0","es5-ext":"^0.10.50","typedarray-to-buffer":"^3.1.5","utf-8-validate":"^5.0.2",yaeti:"^0.0.6"},Nr={"buffer-equal":"^1.0.0",gulp:"^4.0.2","gulp-jshint":"^2.0.4","jshint-stylish":"^2.2.1",jshint:"^2.0.0",tape:"^4.9.1"},Fr={verbose:!1},Br={test:"tape test/unit/*.js",gulp:"gulp"},Mr="index",qr={lib:"./lib"},Jr="lib/browser.js",Hr="Apache-2.0",zr={name:jr,description:Ar,keywords:xr,author:Pr,contributors:Rr,version:Cr,repository:Ir,homepage:Dr,engines:Ur,dependencies:Lr,devDependencies:Nr,config:Fr,scripts:Br,main:Mr,directories:qr,browser:Jr,license:Hr};var Gr=zr.version,V;if(typeof globalThis=="object")V=globalThis;else try{V=$r()}catch{}finally{if(!V&&typeof window<"u"&&(V=window),!V)throw new Error("Could not determine global this")}var ve=V.WebSocket||V.MozWebSocket,Kr=Gr;function Rt(i,e){var t;return e?t=new ve(i,e):t=new ve(i),t}ve&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(i){Object.defineProperty(Rt,i,{get:function(){return ve[i]}})});var Vr={w3cwebsocket:ve?Rt:null,version:Kr};const Wr="2.7.3",Xr={"X-Client-Info":`realtime-js/${Wr}`},Qr="1.0.0",Ct=1e4,Zr=1e3;var ue;(function(i){i[i.connecting=0]="connecting",i[i.open=1]="open",i[i.closing=2]="closing",i[i.closed=3]="closed"})(ue||(ue={}));var D;(function(i){i.closed="closed",i.errored="errored",i.joined="joined",i.joining="joining",i.leaving="leaving"})(D||(D={}));var L;(function(i){i.close="phx_close",i.error="phx_error",i.join="phx_join",i.reply="phx_reply",i.leave="phx_leave",i.access_token="access_token"})(L||(L={}));var Ge;(function(i){i.websocket="websocket"})(Ge||(Ge={}));var W;(function(i){i.Connecting="connecting",i.Open="open",i.Closing="closing",i.Closed="closed"})(W||(W={}));class It{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}class Yr{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const n=t.getUint8(1),s=t.getUint8(2);let o=this.HEADER_LENGTH+2;const a=r.decode(e.slice(o,o+n));o=o+n;const h=r.decode(e.slice(o,o+s));o=o+s;const c=JSON.parse(r.decode(e.slice(o,e.byteLength)));return{ref:null,topic:a,event:h,payload:c}}}class Ue{constructor(e,t,r={},n=Ct){this.channel=e,this.event=t,this.payload=r,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null,this.rateLimited=!1}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){if(this._hasReceived("timeout"))return;this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()})==="rate limited"&&(this.rateLimited=!0)}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var ht;(function(i){i.SYNC="sync",i.JOIN="join",i.LEAVE="leave"})(ht||(ht={}));class de{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},n=>{const{onJoin:s,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=de.syncState(this.state,n,s,o),this.pendingDiffs.forEach(h=>{this.state=de.syncDiff(this.state,h,s,o)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},n=>{const{onJoin:s,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=de.syncDiff(this.state,n,s,o),a())}),this.onJoin((n,s,o)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:s,newPresences:o})}),this.onLeave((n,s,o)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:s,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,n){const s=this.cloneDeep(e),o=this.transformState(t),a={},h={};return this.map(s,(c,l)=>{o[c]||(h[c]=l)}),this.map(o,(c,l)=>{const u=s[c];if(u){const f=l.map(g=>g.presence_ref),v=u.map(g=>g.presence_ref),_=l.filter(g=>v.indexOf(g.presence_ref)<0),y=u.filter(g=>f.indexOf(g.presence_ref)<0);_.length>0&&(a[c]=_),y.length>0&&(h[c]=y)}else a[c]=l}),this.syncDiff(s,{joins:a,leaves:h},r,n)}static syncDiff(e,t,r,n){const{joins:s,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),n||(n=()=>{}),this.map(s,(a,h)=>{var c;const l=(c=e[a])!==null&&c!==void 0?c:[];if(e[a]=this.cloneDeep(h),l.length>0){const u=e[a].map(v=>v.presence_ref),f=l.filter(v=>u.indexOf(v.presence_ref)<0);e[a].unshift(...f)}r(a,l,h)}),this.map(o,(a,h)=>{let c=e[a];if(!c)return;const l=h.map(u=>u.presence_ref);c=c.filter(u=>l.indexOf(u.presence_ref)<0),e[a]=c,n(a,c,h),c.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const n=e[r];return"metas"in n?t[r]=n.metas.map(s=>(s.presence_ref=s.phx_ref,delete s.phx_ref,delete s.phx_ref_prev,s)):t[r]=n,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var E;(function(i){i.abstime="abstime",i.bool="bool",i.date="date",i.daterange="daterange",i.float4="float4",i.float8="float8",i.int2="int2",i.int4="int4",i.int4range="int4range",i.int8="int8",i.int8range="int8range",i.json="json",i.jsonb="jsonb",i.money="money",i.numeric="numeric",i.oid="oid",i.reltime="reltime",i.text="text",i.time="time",i.timestamp="timestamp",i.timestamptz="timestamptz",i.timetz="timetz",i.tsrange="tsrange",i.tstzrange="tstzrange"})(E||(E={}));const ut=(i,e,t={})=>{var r;const n=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((s,o)=>(s[o]=ei(o,i,e,n),s),{})},ei=(i,e,t,r)=>{const n=e.find(a=>a.name===i),s=n==null?void 0:n.type,o=t[i];return s&&!r.includes(s)?Dt(s,o):Ke(o)},Dt=(i,e)=>{if(i.charAt(0)==="_"){const t=i.slice(1,i.length);return si(e,t)}switch(i){case E.bool:return ti(e);case E.float4:case E.float8:case E.int2:case E.int4:case E.int8:case E.numeric:case E.oid:return ri(e);case E.json:case E.jsonb:return ii(e);case E.timestamp:return ni(e);case E.abstime:case E.date:case E.daterange:case E.int4range:case E.int8range:case E.money:case E.reltime:case E.text:case E.time:case E.timestamptz:case E.timetz:case E.tsrange:case E.tstzrange:return Ke(e);default:return Ke(e)}},Ke=i=>i,ti=i=>{switch(i){case"t":return!0;case"f":return!1;default:return i}},ri=i=>{if(typeof i=="string"){const e=parseFloat(i);if(!Number.isNaN(e))return e}return i},ii=i=>{if(typeof i=="string")try{return JSON.parse(i)}catch(e){return console.log(`JSON parse error: ${e}`),i}return i},si=(i,e)=>{if(typeof i!="string")return i;const t=i.length-1,r=i[t];if(i[0]==="{"&&r==="}"){let s;const o=i.slice(1,t);try{s=JSON.parse("["+o+"]")}catch{s=o?o.split(","):[]}return s.map(a=>Dt(e,a))}return i},ni=i=>typeof i=="string"?i.replace(" ","T"):i;var dt=globalThis&&globalThis.__awaiter||function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(l){try{c(r.next(l))}catch(u){o(u)}}function h(l){try{c(r.throw(l))}catch(u){o(u)}}function c(l){l.done?s(l.value):n(l.value).then(a,h)}c((r=r.apply(i,e||[])).next())})},ft;(function(i){i.ALL="*",i.INSERT="INSERT",i.UPDATE="UPDATE",i.DELETE="DELETE"})(ft||(ft={}));var pt;(function(i){i.BROADCAST="broadcast",i.PRESENCE="presence",i.POSTGRES_CHANGES="postgres_changes"})(pt||(pt={}));var vt;(function(i){i.SUBSCRIBED="SUBSCRIBED",i.TIMED_OUT="TIMED_OUT",i.CLOSED="CLOSED",i.CHANNEL_ERROR="CHANNEL_ERROR"})(vt||(vt={}));class et{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=D.closed,this.joinedOnce=!1,this.pushBuffer=[],this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""}},t.config),this.timeout=this.socket.timeout,this.joinPush=new Ue(this,L.join,this.params,this.timeout),this.rejoinTimer=new It(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=D.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=D.closed,this.socket._remove(this)}),this._onError(n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=D.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=D.errored,this.rejoinTimer.scheduleTimeout())}),this._on(L.reply,{},(n,s)=>{this._trigger(this._replyEventName(s),n)}),this.presence=new de(this)}subscribe(e,t=this.timeout){var r,n;if(this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:s,presence:o}}=this.params;this._onError(c=>e&&e("CHANNEL_ERROR",c)),this._onClose(()=>e&&e("CLOSED"));const a={},h={broadcast:s,presence:o,postgres_changes:(n=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(c=>c.filter))!==null&&n!==void 0?n:[]};this.socket.accessToken&&(a.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:h},a)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",({postgres_changes:c})=>{var l;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),c===void 0){e&&e("SUBSCRIBED");return}else{const u=this.bindings.postgres_changes,f=(l=u==null?void 0:u.length)!==null&&l!==void 0?l:0,v=[];for(let _=0;_<f;_++){const y=u[_],{filter:{event:g,schema:O,table:m,filter:$}}=y,A=c&&c[_];if(A&&A.event===g&&A.schema===O&&A.table===m&&A.filter===$)v.push(Object.assign(Object.assign({},y),{id:A.id}));else{this.unsubscribe(),e&&e("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=v,e&&e("SUBSCRIBED");return}}).receive("error",c=>{e&&e("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(c).join(", ")||"error")))}).receive("timeout",()=>{e&&e("TIMED_OUT")})}return this}presenceState(){return this.presence.state}track(e,t={}){return dt(this,void 0,void 0,function*(){return yield this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)})}untrack(e={}){return dt(this,void 0,void 0,function*(){return yield this.send({type:"presence",event:"untrack"},e)})}on(e,t,r){return this._on(e,t,r)}send(e,t={}){return new Promise(r=>{var n,s,o;const a=this._push(e.type,e,t.timeout||this.timeout);a.rateLimited&&r("rate limited"),e.type==="broadcast"&&!(!((o=(s=(n=this.params)===null||n===void 0?void 0:n.config)===null||s===void 0?void 0:s.broadcast)===null||o===void 0)&&o.ack)&&r("ok"),a.receive("ok",()=>r("ok")),a.receive("timeout",()=>r("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=D.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(L.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{const n=new Ue(this,L.leave,{},e);n.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),n.send(),this._canPush()||n.trigger("ok",{})})}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new Ue(this,e,t,r);return this._canPush()?n.send():(n.startTimeout(),this.pushBuffer.push(n)),n}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var n,s;const o=e.toLocaleLowerCase(),{close:a,error:h,leave:c,join:l}=L;if(r&&[a,h,c,l].indexOf(o)>=0&&r!==this._joinRef())return;let f=this._onMessage(o,t,r);if(t&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(v=>{var _,y,g;return((_=v.filter)===null||_===void 0?void 0:_.event)==="*"||((g=(y=v.filter)===null||y===void 0?void 0:y.event)===null||g===void 0?void 0:g.toLocaleLowerCase())===o}).map(v=>v.callback(f,r)):(s=this.bindings[o])===null||s===void 0||s.filter(v=>{var _,y,g,O,m,$;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in v){const A=v.id,z=(_=v.filter)===null||_===void 0?void 0:_.event;return A&&((y=t.ids)===null||y===void 0?void 0:y.includes(A))&&(z==="*"||(z==null?void 0:z.toLocaleLowerCase())===((g=t.data)===null||g===void 0?void 0:g.type.toLocaleLowerCase()))}else{const A=(m=(O=v==null?void 0:v.filter)===null||O===void 0?void 0:O.event)===null||m===void 0?void 0:m.toLocaleLowerCase();return A==="*"||A===(($=t==null?void 0:t.event)===null||$===void 0?void 0:$.toLocaleLowerCase())}else return v.type.toLocaleLowerCase()===o}).map(v=>{if(typeof f=="object"&&"ids"in f){const _=f.data,{schema:y,table:g,commit_timestamp:O,type:m,errors:$}=_;f=Object.assign(Object.assign({},{schema:y,table:g,commit_timestamp:O,eventType:m,new:{},old:{},errors:$}),this._getPayloadRecords(_))}v.callback(f,r)})}_isClosed(){return this.state===D.closed}_isJoined(){return this.state===D.joined}_isJoining(){return this.state===D.joining}_isLeaving(){return this.state===D.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const n=e.toLocaleLowerCase(),s={type:n,filter:t,callback:r};return this.bindings[n]?this.bindings[n].push(s):this.bindings[n]=[s],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(n=>{var s;return!(((s=n.type)===null||s===void 0?void 0:s.toLocaleLowerCase())===r&&et.isEqual(n.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(L.close,{},e)}_onError(e){this._on(L.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=D.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=ut(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=ut(e.columns,e.old_record)),t}}var Le=globalThis&&globalThis.__awaiter||function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(l){try{c(r.next(l))}catch(u){o(u)}}function h(l){try{c(r.throw(l))}catch(u){o(u)}}function c(l){l.done?s(l.value):n(l.value).then(a,h)}c((r=r.apply(i,e||[])).next())})};const oi=()=>{};class ai{constructor(e,t){var r;this.accessToken=null,this.channels=[],this.endPoint="",this.headers=Xr,this.params={},this.timeout=Ct,this.transport=Vr.w3cwebsocket,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=oi,this.conn=null,this.sendBuffer=[],this.serializer=new Yr,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.eventsPerSecondLimitMs=100,this.inThrottle=!1,this.endPoint=`${e}/${Ge.websocket}`,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.transport&&(this.transport=t.transport),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const n=(r=t==null?void 0:t.params)===null||r===void 0?void 0:r.eventsPerSecond;n&&(this.eventsPerSecondLimitMs=Math.floor(1e3/n)),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:s=>[1e3,2e3,5e3,1e4][s-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(s,o)=>o(JSON.stringify(s)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new It(()=>Le(this,void 0,void 0,function*(){this.disconnect(),this.connect()}),this.reconnectAfterMs)}connect(){this.conn||(this.conn=new this.transport(this._endPointURL(),[],null,this.headers),this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e)))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}removeChannel(e){return Le(this,void 0,void 0,function*(){const t=yield e.unsubscribe();return this.channels.length===0&&this.disconnect(),t})}removeAllChannels(){return Le(this,void 0,void 0,function*(){const e=yield Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e})}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case ue.connecting:return W.Connecting;case ue.open:return W.Open;case ue.closing:return W.Closing;default:return W.Closed}}isConnected(){return this.connectionState()===W.Open}channel(e,t={config:{}}){this.isConnected()||this.connect();const r=new et(`realtime:${e}`,t,this);return this.channels.push(r),r}push(e){const{topic:t,event:r,payload:n,ref:s}=e;let o=()=>{this.encode(e,a=>{var h;(h=this.conn)===null||h===void 0||h.send(a)})};if(this.log("push",`${t} ${r} (${s})`,n),this.isConnected())if(["broadcast","presence","postgres_changes"].includes(r)){if(this._throttle(o)())return"rate limited"}else o();else this.sendBuffer.push(o)}setAuth(e){this.accessToken=e,this.channels.forEach(t=>{e&&t.updateJoinPayload({access_token:e}),t.joinedOnce&&t._isJoined()&&t._push(L.access_token,{access_token:e})})}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Qr}))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:r,event:n,payload:s,ref:o}=t;(o&&o===this.pendingHeartbeatRef||n===(s==null?void 0:s.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${s.status||""} ${r} ${n} ${o&&"("+o+")"||""}`,s),this.channels.filter(a=>a._isMember(r)).forEach(a=>a._trigger(n,s,o)),this.stateChangeCallbacks.message.forEach(a=>a(t))})}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(L.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",n=new URLSearchParams(t);return`${e}${r}${n}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(Zr,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}_throttle(e,t=this.eventsPerSecondLimitMs){return()=>this.inThrottle?!0:(e(),t>0&&(this.inThrottle=!0,setTimeout(()=>{this.inThrottle=!1},t)),!1)}}class tt extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function P(i){return typeof i=="object"&&i!==null&&"__isStorageError"in i}class li extends tt{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class gt extends tt{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Ut=globalThis&&globalThis.__awaiter||function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(l){try{c(r.next(l))}catch(u){o(u)}}function h(l){try{c(r.throw(l))}catch(u){o(u)}}function c(l){l.done?s(l.value):n(l.value).then(a,h)}c((r=r.apply(i,e||[])).next())})};const Lt=i=>{let e;return i?e=i:typeof fetch>"u"?e=(...t)=>Ut(void 0,void 0,void 0,function*(){return yield(yield je(()=>Promise.resolve().then(()=>Ae),void 0)).fetch(...t)}):e=fetch,(...t)=>e(...t)},ci=()=>Ut(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield je(()=>Promise.resolve().then(()=>Ae),void 0)).Response:Response});var se=globalThis&&globalThis.__awaiter||function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(l){try{c(r.next(l))}catch(u){o(u)}}function h(l){try{c(r.throw(l))}catch(u){o(u)}}function c(l){l.done?s(l.value):n(l.value).then(a,h)}c((r=r.apply(i,e||[])).next())})};const Ne=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),hi=(i,e)=>se(void 0,void 0,void 0,function*(){const t=yield ci();i instanceof t?i.json().then(r=>{e(new li(Ne(r),i.status||500))}).catch(r=>{e(new gt(Ne(r),r))}):e(new gt(Ne(i),i))}),ui=(i,e,t,r)=>{const n={method:i,headers:(e==null?void 0:e.headers)||{}};return i==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),n.body=JSON.stringify(r),Object.assign(Object.assign({},n),t))};function xe(i,e,t,r,n,s){return se(this,void 0,void 0,function*(){return new Promise((o,a)=>{i(t,ui(e,r,n,s)).then(h=>{if(!h.ok)throw h;return r!=null&&r.noResolveJson?h:h.json()}).then(h=>o(h)).catch(h=>hi(h,a))})})}function Ve(i,e,t,r){return se(this,void 0,void 0,function*(){return xe(i,"GET",e,t,r)})}function H(i,e,t,r,n){return se(this,void 0,void 0,function*(){return xe(i,"POST",e,r,n,t)})}function di(i,e,t,r,n){return se(this,void 0,void 0,function*(){return xe(i,"PUT",e,r,n,t)})}function Nt(i,e,t,r,n){return se(this,void 0,void 0,function*(){return xe(i,"DELETE",e,r,n,t)})}var U=globalThis&&globalThis.__awaiter||function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(l){try{c(r.next(l))}catch(u){o(u)}}function h(l){try{c(r.throw(l))}catch(u){o(u)}}function c(l){l.done?s(l.value):n(l.value).then(a,h)}c((r=r.apply(i,e||[])).next())})};const fi={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},_t={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class pi{constructor(e,t={},r,n){this.url=e,this.headers=t,this.bucketId=r,this.fetch=Lt(n)}uploadOrUpdate(e,t,r,n){return U(this,void 0,void 0,function*(){try{let s;const o=Object.assign(Object.assign({},_t),n),a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});typeof Blob<"u"&&r instanceof Blob?(s=new FormData,s.append("cacheControl",o.cacheControl),s.append("",r)):typeof FormData<"u"&&r instanceof FormData?(s=r,s.append("cacheControl",o.cacheControl)):(s=r,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType);const h=this._removeEmptyFolders(t),c=this._getFinalPath(h),l=yield this.fetch(`${this.url}/object/${c}`,Object.assign({method:e,body:s,headers:a},o!=null&&o.duplex?{duplex:o.duplex}:{}));return l.ok?{data:{path:h},error:null}:{data:null,error:yield l.json()}}catch(s){if(P(s))return{data:null,error:s};throw s}})}upload(e,t,r){return U(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,n){return U(this,void 0,void 0,function*(){const s=this._removeEmptyFolders(e),o=this._getFinalPath(s),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",t);try{let h;const c=Object.assign({upsert:_t.upsert},n),l=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&r instanceof Blob?(h=new FormData,h.append("cacheControl",c.cacheControl),h.append("",r)):typeof FormData<"u"&&r instanceof FormData?(h=r,h.append("cacheControl",c.cacheControl)):(h=r,l["cache-control"]=`max-age=${c.cacheControl}`,l["content-type"]=c.contentType);const u=yield this.fetch(a.toString(),{method:"PUT",body:h,headers:l});return u.ok?{data:{path:s},error:null}:{data:null,error:yield u.json()}}catch(h){if(P(h))return{data:null,error:h};throw h}})}createSignedUploadUrl(e){return U(this,void 0,void 0,function*(){try{let t=this._getFinalPath(e);const r=yield H(this.fetch,`${this.url}/object/upload/sign/${t}`,{},{headers:this.headers}),n=new URL(this.url+r.url),s=n.searchParams.get("token");if(!s)throw new tt("No token returned by API");return{data:{signedUrl:n.toString(),path:e,token:s},error:null}}catch(t){if(P(t))return{data:null,error:t};throw t}})}update(e,t,r){return U(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t){return U(this,void 0,void 0,function*(){try{return{data:yield H(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers}),error:null}}catch(r){if(P(r))return{data:null,error:r};throw r}})}copy(e,t){return U(this,void 0,void 0,function*(){try{return{data:{path:(yield H(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers})).Key},error:null}}catch(r){if(P(r))return{data:null,error:r};throw r}})}createSignedUrl(e,t,r){return U(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),s=yield H(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:t},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const o=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return s={signedUrl:encodeURI(`${this.url}${s.signedURL}${o}`)},{data:s,error:null}}catch(n){if(P(n))return{data:null,error:n};throw n}})}createSignedUrls(e,t,r){return U(this,void 0,void 0,function*(){try{const n=yield H(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),s=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:n.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${s}`):null})),error:null}}catch(n){if(P(n))return{data:null,error:n};throw n}})}download(e,t){return U(this,void 0,void 0,function*(){const n=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",s=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),o=s?`?${s}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield Ve(this.fetch,`${this.url}/${n}/${a}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(P(a))return{data:null,error:a};throw a}})}getPublicUrl(e,t){const r=this._getFinalPath(e),n=[],s=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";s!==""&&n.push(s);const a=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",h=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});h!==""&&n.push(h);let c=n.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${c}`)}}}remove(e){return U(this,void 0,void 0,function*(){try{return{data:yield Nt(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(P(t))return{data:null,error:t};throw t}})}list(e,t,r){return U(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},fi),t),{prefix:e||""});return{data:yield H(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},r),error:null}}catch(n){if(P(n))return{data:null,error:n};throw n}})}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const vi="2.5.1",gi={"X-Client-Info":`storage-js/${vi}`};var Y=globalThis&&globalThis.__awaiter||function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(l){try{c(r.next(l))}catch(u){o(u)}}function h(l){try{c(r.throw(l))}catch(u){o(u)}}function c(l){l.done?s(l.value):n(l.value).then(a,h)}c((r=r.apply(i,e||[])).next())})};class _i{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},gi),t),this.fetch=Lt(r)}listBuckets(){return Y(this,void 0,void 0,function*(){try{return{data:yield Ve(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(P(e))return{data:null,error:e};throw e}})}getBucket(e){return Y(this,void 0,void 0,function*(){try{return{data:yield Ve(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(P(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return Y(this,void 0,void 0,function*(){try{return{data:yield H(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(P(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return Y(this,void 0,void 0,function*(){try{return{data:yield di(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(P(r))return{data:null,error:r};throw r}})}emptyBucket(e){return Y(this,void 0,void 0,function*(){try{return{data:yield H(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(P(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Y(this,void 0,void 0,function*(){try{return{data:yield Nt(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(P(t))return{data:null,error:t};throw t}})}}class yi extends _i{constructor(e,t={},r){super(e,t,r)}from(e){return new pi(this.url,this.headers,e,this.fetch)}}const mi="2.26.0",bi={"X-Client-Info":`supabase-js/${mi}`};var wi=globalThis&&globalThis.__awaiter||function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(l){try{c(r.next(l))}catch(u){o(u)}}function h(l){try{c(r.throw(l))}catch(u){o(u)}}function c(l){l.done?s(l.value):n(l.value).then(a,h)}c((r=r.apply(i,e||[])).next())})};const Ti=i=>{let e;return i?e=i:typeof fetch>"u"?e=Ye:e=fetch,(...t)=>e(...t)},Si=()=>typeof Headers>"u"?Ze.Headers:Headers,Oi=(i,e,t)=>{const r=Ti(t),n=Si();return(s,o)=>wi(void 0,void 0,void 0,function*(){var a;const h=(a=yield e())!==null&&a!==void 0?a:i;let c=new n(o==null?void 0:o.headers);return c.has("apikey")||c.set("apikey",i),c.has("Authorization")||c.set("Authorization",`Bearer ${h}`),r(s,Object.assign(Object.assign({},o),{headers:c}))})};function ki(i){return i.replace(/\/$/,"")}function Ei(i,e){const{db:t,auth:r,realtime:n,global:s}=i,{db:o,auth:a,realtime:h,global:c}=e;return{db:Object.assign(Object.assign({},o),t),auth:Object.assign(Object.assign({},a),r),realtime:Object.assign(Object.assign({},h),n),global:Object.assign(Object.assign({},c),s)}}var Q=globalThis&&globalThis.__awaiter||function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(l){try{c(r.next(l))}catch(u){o(u)}}function h(l){try{c(r.throw(l))}catch(u){o(u)}}function c(l){l.done?s(l.value):n(l.value).then(a,h)}c((r=r.apply(i,e||[])).next())})};function $i(i){return Math.round(Date.now()/1e3)+i}function ji(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){const e=Math.random()*16|0;return(i=="x"?e:e&3|8).toString(16)})}const q=()=>typeof document<"u",K={tested:!1,writable:!1},Oe=()=>{if(!q())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(K.tested)return K.writable;const i=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(i,i),globalThis.localStorage.removeItem(i),K.tested=!0,K.writable=!0}catch{K.tested=!0,K.writable=!1}return K.writable};function I(i,e){var t;e||(e=((t=window==null?void 0:window.location)===null||t===void 0?void 0:t.href)||""),i=i.replace(/[\[\]]/g,"\\$&");const r=new RegExp("[?&#]"+i+"(=([^&#]*)|&|#|$)"),n=r.exec(e);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}const Ft=i=>{let e;return i?e=i:typeof fetch>"u"?e=(...t)=>Q(void 0,void 0,void 0,function*(){return yield(yield je(()=>Promise.resolve().then(()=>Ae),void 0)).fetch(...t)}):e=fetch,(...t)=>e(...t)},Ai=i=>typeof i=="object"&&i!==null&&"status"in i&&"ok"in i&&"json"in i&&typeof i.json=="function",ae=(i,e,t)=>Q(void 0,void 0,void 0,function*(){yield i.setItem(e,JSON.stringify(t))}),me=(i,e)=>Q(void 0,void 0,void 0,function*(){const t=yield i.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}}),Fe=(i,e)=>Q(void 0,void 0,void 0,function*(){yield i.removeItem(e)});function xi(i){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t="",r,n,s,o,a,h,c,l=0;for(i=i.replace("-","+").replace("_","/");l<i.length;)o=e.indexOf(i.charAt(l++)),a=e.indexOf(i.charAt(l++)),h=e.indexOf(i.charAt(l++)),c=e.indexOf(i.charAt(l++)),r=o<<2|a>>4,n=(a&15)<<4|h>>2,s=(h&3)<<6|c,t=t+String.fromCharCode(r),h!=64&&n!=0&&(t=t+String.fromCharCode(n)),c!=64&&s!=0&&(t=t+String.fromCharCode(s));return t}class Pe{constructor(){this.promise=new Pe.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Pe.promiseConstructor=Promise;function yt(i){const e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,t=i.split(".");if(t.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const r=t[1];return JSON.parse(xi(r))}function Pi(i){return new Promise(e=>{setTimeout(()=>e(null),i)})}function Ri(i,e){return new Promise((r,n)=>{Q(this,void 0,void 0,function*(){for(let s=0;s<1/0;s++)try{const o=yield i(s);if(!e(s,null,o)){r(o);return}}catch(o){if(!e(s,o)){n(o);return}}})})}function Ci(i){return("0"+i.toString(16)).substr(-2)}function be(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let n="";for(let s=0;s<56;s++)n+=t.charAt(Math.floor(Math.random()*r));return n}return crypto.getRandomValues(e),Array.from(e,Ci).join("")}function Ii(i){return Q(this,void 0,void 0,function*(){const t=new TextEncoder().encode(i),r=yield crypto.subtle.digest("SHA-256",t),n=new Uint8Array(r);return Array.from(n).map(s=>String.fromCharCode(s)).join("")})}function Di(i){return btoa(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function we(i){return Q(this,void 0,void 0,function*(){if(typeof crypto>"u")return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),i;const e=yield Ii(i);return Di(e)})}class rt extends Error{constructor(e,t){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t}}function T(i){return typeof i=="object"&&i!==null&&"__isAuthError"in i}class Ui extends rt{constructor(e,t){super(e,t),this.name="AuthApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}function Li(i){return T(i)&&i.name==="AuthApiError"}class Bt extends rt{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class ne extends rt{constructor(e,t,r){super(e),this.name=t,this.status=r}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class ee extends ne{constructor(){super("Auth session missing!","AuthSessionMissingError",400)}}class Be extends ne{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500)}}class Te extends ne{constructor(e){super(e,"AuthInvalidCredentialsError",400)}}class M extends ne{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Me extends ne{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class We extends ne{constructor(e,t){super(e,"AuthRetryableFetchError",t)}}function mt(i){return T(i)&&i.name==="AuthRetryableFetchError"}var it=globalThis&&globalThis.__awaiter||function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(l){try{c(r.next(l))}catch(u){o(u)}}function h(l){try{c(r.throw(l))}catch(u){o(u)}}function c(l){l.done?s(l.value):n(l.value).then(a,h)}c((r=r.apply(i,e||[])).next())})},Ni=globalThis&&globalThis.__rest||function(i,e){var t={};for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&e.indexOf(r)<0&&(t[r]=i[r]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(i);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(i,r[n])&&(t[r[n]]=i[r[n]]);return t};const le=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),Fi=[502,503,504];function bt(i){return it(this,void 0,void 0,function*(){if(!Ai(i))throw new We(le(i),0);if(Fi.includes(i.status))throw new We(le(i),i.status);let e;try{e=yield i.json()}catch(t){throw new Bt(le(t),t)}throw new Ui(le(e),i.status||500)})}const Bi=(i,e,t,r)=>{const n={method:i,headers:(e==null?void 0:e.headers)||{}};return i==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),n.body=JSON.stringify(r),Object.assign(Object.assign({},n),t))};function S(i,e,t,r){var n;return it(this,void 0,void 0,function*(){const s=Object.assign({},r==null?void 0:r.headers);r!=null&&r.jwt&&(s.Authorization=`Bearer ${r.jwt}`);const o=(n=r==null?void 0:r.query)!==null&&n!==void 0?n:{};r!=null&&r.redirectTo&&(o.redirect_to=r.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",h=yield Mi(i,e,t+a,{headers:s,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(h):{data:Object.assign({},h),error:null}})}function Mi(i,e,t,r,n,s){return it(this,void 0,void 0,function*(){const o=Bi(e,r,n,s);let a;try{a=yield i(t,o)}catch(h){throw console.error(h),new We(le(h),0)}if(a.ok||(yield bt(a)),r!=null&&r.noResolveJson)return a;try{return yield a.json()}catch(h){yield bt(h)}})}function J(i){var e;let t=null;zi(i)&&(t=Object.assign({},i),t.expires_at=$i(i.expires_in));const r=(e=i.user)!==null&&e!==void 0?e:i;return{data:{session:t,user:r},error:null}}function X(i){var e;return{data:{user:(e=i.user)!==null&&e!==void 0?e:i},error:null}}function qi(i){return{data:i,error:null}}function Ji(i){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:n,verification_type:s}=i,o=Ni(i,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:r,redirect_to:n,verification_type:s},h=Object.assign({},o);return{data:{properties:a,user:h},error:null}}function Hi(i){return i}function zi(i){return i.access_token&&i.refresh_token&&i.expires_in}var B=globalThis&&globalThis.__awaiter||function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(l){try{c(r.next(l))}catch(u){o(u)}}function h(l){try{c(r.throw(l))}catch(u){o(u)}}function c(l){l.done?s(l.value):n(l.value).then(a,h)}c((r=r.apply(i,e||[])).next())})},Gi=globalThis&&globalThis.__rest||function(i,e){var t={};for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&e.indexOf(r)<0&&(t[r]=i[r]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(i);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(i,r[n])&&(t[r[n]]=i[r[n]]);return t};class Ki{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=Ft(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}signOut(e){return B(this,void 0,void 0,function*(){try{return yield S(this.fetch,"POST",`${this.url}/logout`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(t){if(T(t))return{data:null,error:t};throw t}})}inviteUserByEmail(e,t={}){return B(this,void 0,void 0,function*(){try{return yield S(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:X})}catch(r){if(T(r))return{data:{user:null},error:r};throw r}})}generateLink(e){return B(this,void 0,void 0,function*(){try{const{options:t}=e,r=Gi(e,["options"]),n=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(n.new_email=r==null?void 0:r.newEmail,delete n.newEmail),yield S(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:Ji,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(T(t))return{data:{properties:null,user:null},error:t};throw t}})}createUser(e){return B(this,void 0,void 0,function*(){try{return yield S(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:X})}catch(t){if(T(t))return{data:{user:null},error:t};throw t}})}listUsers(e){var t,r,n,s,o,a,h;return B(this,void 0,void 0,function*(){try{const c={nextPage:null,lastPage:0,total:0},l=yield S(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(s=(n=e==null?void 0:e.perPage)===null||n===void 0?void 0:n.toString())!==null&&s!==void 0?s:""},xform:Hi});if(l.error)throw l.error;const u=yield l.json(),f=(o=l.headers.get("x-total-count"))!==null&&o!==void 0?o:0,v=(h=(a=l.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&h!==void 0?h:[];return v.length>0&&(v.forEach(_=>{const y=parseInt(_.split(";")[0].split("=")[1].substring(0,1)),g=JSON.parse(_.split(";")[1].split("=")[1]);c[`${g}Page`]=y}),c.total=parseInt(f)),{data:Object.assign(Object.assign({},u),c),error:null}}catch(c){if(T(c))return{data:{users:[]},error:c};throw c}})}getUserById(e){return B(this,void 0,void 0,function*(){try{return yield S(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:X})}catch(t){if(T(t))return{data:{user:null},error:t};throw t}})}updateUserById(e,t){return B(this,void 0,void 0,function*(){try{return yield S(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:X})}catch(r){if(T(r))return{data:{user:null},error:r};throw r}})}deleteUser(e,t=!1){return B(this,void 0,void 0,function*(){try{return yield S(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:X})}catch(r){if(T(r))return{data:{user:null},error:r};throw r}})}_listFactors(e){return B(this,void 0,void 0,function*(){try{const{data:t,error:r}=yield S(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:t,error:r}}catch(t){if(T(t))return{data:null,error:t};throw t}})}_deleteFactor(e){return B(this,void 0,void 0,function*(){try{return{data:yield S(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(T(t))return{data:null,error:t};throw t}})}}const Vi="2.37.0",Wi="http://localhost:9999",Xi="supabase.auth.token",Qi={"X-Client-Info":`gotrue-js/${Vi}`},wt=10,Tt={getItem:i=>Oe()?globalThis.localStorage.getItem(i):null,setItem:(i,e)=>{Oe()&&globalThis.localStorage.setItem(i,e)},removeItem:i=>{Oe()&&globalThis.localStorage.removeItem(i)}};function Zi(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}var b=globalThis&&globalThis.__awaiter||function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(l){try{c(r.next(l))}catch(u){o(u)}}function h(l){try{c(r.throw(l))}catch(u){o(u)}}function c(l){l.done?s(l.value):n(l.value).then(a,h)}c((r=r.apply(i,e||[])).next())})};Zi();const Yi={url:Wi,storageKey:Xi,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Qi,flowType:"implicit",debug:!1},Se=30*1e3,St=3;class ge{constructor(e){var t;this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.broadcastChannel=null,this.instanceID=ge.nextInstanceID,ge.nextInstanceID+=1,this.instanceID>0&&q()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const r=Object.assign(Object.assign({},Yi),e);if(this.logDebugMessages=r.debug,this.inMemorySession=null,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.persistSession=r.persistSession,this.storage=r.storage||Tt,this.admin=new Ki({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=Ft(r.fetch),this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession&&this.storage===Tt&&!Oe()&&console.warn(`No storage option exists to persist the session, which may result in unexpected behavior when using auth.
        If you want to set persistSession to true, please provide a storage option or you may set persistSession to false to disable this warning.`),q()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(n){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",n)}(t=this.broadcastChannel)===null||t===void 0||t.addEventListener("message",n=>b(this,void 0,void 0,function*(){this._debug("received broadcast notification from other tab or client",n),yield this._notifyAllSubscribers(n.data.event,n.data.session,!1)}))}this.initialize()}_debug(...e){return this.logDebugMessages&&console.log(`GoTrueClient@${this.instanceID} ${new Date().toISOString()}`,...e),this}initialize(){return this.initializePromise||(this.initializePromise=this._initialize()),this.initializePromise}_initialize(){return b(this,void 0,void 0,function*(){if(this.initializePromise)return this.initializePromise;try{const e=q()?yield this._isPKCEFlow():!1;if(this._debug("#_initialize()","begin","is PKCE flow",e),e||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:t,error:r}=yield this._getSessionFromUrl(e);if(r)return this._debug("#_initialize()","error detecting session from URL",r),yield this._removeSession(),{error:r};const{session:n,redirectType:s}=t;return this._debug("#_initialize()","detected session in URL",n,"redirect type",s),yield this._saveSession(n),setTimeout(()=>b(this,void 0,void 0,function*(){s==="recovery"?yield this._notifyAllSubscribers("PASSWORD_RECOVERY",n):yield this._notifyAllSubscribers("SIGNED_IN",n)}),0),{error:null}}return yield this._recoverAndRefresh(),{error:null}}catch(e){return T(e)?{error:e}:{error:new Bt("Unexpected error during initialization",e)}}finally{yield this._handleVisibilityChange(),this._debug("#_initialize()","end")}})}signUp(e){var t,r,n;return b(this,void 0,void 0,function*(){try{yield this._removeSession();let s;if("email"in e){const{email:l,password:u,options:f}=e;let v=null,_=null;if(this.flowType==="pkce"){const y=be();yield ae(this.storage,`${this.storageKey}-code-verifier`,y),v=yield we(y),_=y===v?"plain":"s256"}s=yield S(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f==null?void 0:f.emailRedirectTo,body:{email:l,password:u,data:(t=f==null?void 0:f.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken},code_challenge:v,code_challenge_method:_},xform:J})}else if("phone"in e){const{phone:l,password:u,options:f}=e;s=yield S(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:l,password:u,data:(r=f==null?void 0:f.data)!==null&&r!==void 0?r:{},channel:(n=f==null?void 0:f.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}},xform:J})}else throw new Te("You must provide either an email or phone number and a password");const{data:o,error:a}=s;if(a||!o)return{data:{user:null,session:null},error:a};const h=o.session,c=o.user;return o.session&&(yield this._saveSession(o.session),yield this._notifyAllSubscribers("SIGNED_IN",h)),{data:{user:c,session:h},error:null}}catch(s){if(T(s))return{data:{user:null,session:null},error:s};throw s}})}signInWithPassword(e){return b(this,void 0,void 0,function*(){try{yield this._removeSession();let t;if("email"in e){const{email:s,password:o,options:a}=e;t=yield S(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:J})}else if("phone"in e){const{phone:s,password:o,options:a}=e;t=yield S(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:J})}else throw new Te("You must provide either an email or phone number and a password");const{data:r,error:n}=t;return n?{data:{user:null,session:null},error:n}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new Be}:(r.session&&(yield this._saveSession(r.session),yield this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:{user:r.user,session:r.session},error:n})}catch(t){if(T(t))return{data:{user:null,session:null},error:t};throw t}})}signInWithOAuth(e){var t,r,n,s;return b(this,void 0,void 0,function*(){return yield this._removeSession(),yield this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(s=e.options)===null||s===void 0?void 0:s.skipBrowserRedirect})})}exchangeCodeForSession(e){return b(this,void 0,void 0,function*(){const t=yield me(this.storage,`${this.storageKey}-code-verifier`),{data:r,error:n}=yield S(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:t},xform:J});return yield Fe(this.storage,`${this.storageKey}-code-verifier`),n?{data:{user:null,session:null},error:n}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new Be}:(r.session&&(yield this._saveSession(r.session),yield this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:r,error:n})})}signInWithIdToken(e){return b(this,void 0,void 0,function*(){yield this._removeSession();try{const{options:t,provider:r,token:n,access_token:s,nonce:o}=e,a=yield S(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:n,access_token:s,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:J}),{data:h,error:c}=a;return c?{data:{user:null,session:null},error:c}:!h||!h.session||!h.user?{data:{user:null,session:null},error:new Be}:(h.session&&(yield this._saveSession(h.session),yield this._notifyAllSubscribers("SIGNED_IN",h.session)),{data:h,error:c})}catch(t){if(T(t))return{data:{user:null,session:null},error:t};throw t}})}signInWithOtp(e){var t,r,n,s,o;return b(this,void 0,void 0,function*(){try{if(yield this._removeSession(),"email"in e){const{email:a,options:h}=e;let c=null,l=null;if(this.flowType==="pkce"){const f=be();yield ae(this.storage,`${this.storageKey}-code-verifier`,f),c=yield we(f),l=f===c?"plain":"s256"}const{error:u}=yield S(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=h==null?void 0:h.data)!==null&&t!==void 0?t:{},create_user:(r=h==null?void 0:h.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken},code_challenge:c,code_challenge_method:l},redirectTo:h==null?void 0:h.emailRedirectTo});return{data:{user:null,session:null},error:u}}if("phone"in e){const{phone:a,options:h}=e,{data:c,error:l}=yield S(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(n=h==null?void 0:h.data)!==null&&n!==void 0?n:{},create_user:(s=h==null?void 0:h.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken},channel:(o=h==null?void 0:h.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:l}}throw new Te("You must provide either an email or phone number.")}catch(a){if(T(a))return{data:{user:null,session:null},error:a};throw a}})}verifyOtp(e){var t,r;return b(this,void 0,void 0,function*(){try{e.type!=="email_change"&&e.type!=="phone_change"&&(yield this._removeSession());const{data:n,error:s}=yield S(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:(t=e.options)===null||t===void 0?void 0:t.captchaToken}}),redirectTo:(r=e.options)===null||r===void 0?void 0:r.redirectTo,xform:J});if(s)throw s;if(!n)throw new Error("An error occurred on token verification.");const o=n.session,a=n.user;return o!=null&&o.access_token&&(yield this._saveSession(o),yield this._notifyAllSubscribers("SIGNED_IN",o)),{data:{user:a,session:o},error:null}}catch(n){if(T(n))return{data:{user:null,session:null},error:n};throw n}})}signInWithSSO(e){var t,r,n;return b(this,void 0,void 0,function*(){try{return yield this._removeSession(),yield S(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((n=e==null?void 0:e.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0}),headers:this.headers,xform:qi})}catch(s){if(T(s))return{data:null,error:s};throw s}})}reauthenticate(){return b(this,void 0,void 0,function*(){try{const{data:{session:e},error:t}=yield this.getSession();if(t)throw t;if(!e)throw new ee;const{error:r}=yield S(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:e.access_token});return{data:{user:null,session:null},error:r}}catch(e){if(T(e))return{data:{user:null,session:null},error:e};throw e}})}resend(e){return b(this,void 0,void 0,function*(){try{yield this._removeSession();const t=`${this.url}/resend`;if("email"in e){const{email:r,type:n,options:s}=e,{error:o}=yield S(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:n,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}}});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:r,type:n,options:s}=e,{data:o,error:a}=yield S(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:n,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:a}}throw new Te("You must provide either an email or phone number and a type")}catch(t){if(T(t))return{data:{user:null,session:null},error:t};throw t}})}getSession(){return b(this,void 0,void 0,function*(){yield this.initializePromise,this._debug("#getSession()","begin");try{let e=null;if(this.persistSession){const s=yield me(this.storage,this.storageKey);this._debug("#getSession()","session from storage",s),s!==null&&(this._isValidSession(s)?e=s:(this._debug("#getSession()","session from storage is not valid"),yield this._removeSession()))}else e=this.inMemorySession,this._debug("#getSession()","session from memory",e);if(!e)return{data:{session:null},error:null};const t=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#getSession()",`session has${t?"":" not"} expired`,"expires_at",e.expires_at),!t)return{data:{session:e},error:null};const{session:r,error:n}=yield this._callRefreshToken(e.refresh_token);return n?{data:{session:null},error:n}:{data:{session:r},error:null}}finally{this._debug("#getSession()","end")}})}getUser(e){var t,r;return b(this,void 0,void 0,function*(){try{if(!e){const{data:n,error:s}=yield this.getSession();if(s)throw s;e=(r=(t=n.session)===null||t===void 0?void 0:t.access_token)!==null&&r!==void 0?r:void 0}return yield S(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:X})}catch(n){if(T(n))return{data:{user:null},error:n};throw n}})}updateUser(e,t={}){return b(this,void 0,void 0,function*(){try{const{data:r,error:n}=yield this.getSession();if(n)throw n;if(!r.session)throw new ee;const s=r.session,{data:o,error:a}=yield S(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:e,jwt:s.access_token,xform:X});if(a)throw a;return s.user=o.user,yield this._saveSession(s),yield this._notifyAllSubscribers("USER_UPDATED",s),{data:{user:s.user},error:null}}catch(r){if(T(r))return{data:{user:null},error:r};throw r}})}_decodeJWT(e){return yt(e)}setSession(e){return b(this,void 0,void 0,function*(){try{if(!e.access_token||!e.refresh_token)throw new ee;const t=Date.now()/1e3;let r=t,n=!0,s=null;const o=yt(e.access_token);if(o.exp&&(r=o.exp,n=r<=t),n){const{session:a,error:h}=yield this._callRefreshToken(e.refresh_token);if(h)return{data:{user:null,session:null},error:h};if(!a)return{data:{user:null,session:null},error:null};s=a}else{const{data:a,error:h}=yield this.getUser(e.access_token);if(h)throw h;s={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:r-t,expires_at:r},yield this._saveSession(s),yield this._notifyAllSubscribers("SIGNED_IN",s)}return{data:{user:s.user,session:s},error:null}}catch(t){if(T(t))return{data:{session:null,user:null},error:t};throw t}})}refreshSession(e){var t;return b(this,void 0,void 0,function*(){try{if(!e){const{data:s,error:o}=yield this.getSession();if(o)throw o;e=(t=s.session)!==null&&t!==void 0?t:void 0}if(!(e!=null&&e.refresh_token))throw new ee;const{session:r,error:n}=yield this._callRefreshToken(e.refresh_token);return n?{data:{user:null,session:null},error:n}:r?{data:{user:r.user,session:r},error:null}:{data:{user:null,session:null},error:null}}catch(r){if(T(r))return{data:{user:null,session:null},error:r};throw r}})}_getSessionFromUrl(e){return b(this,void 0,void 0,function*(){try{if(!q())throw new M("No browser detected.");if(this.flowType==="implicit"&&!this._isImplicitGrantFlow())throw new M("Not a valid implicit grant flow url.");if(this.flowType=="pkce"&&!e)throw new Me("Not a valid PKCE flow url.");if(e){const g=I("code");if(!g)throw new Me("No code detected.");const{data:O,error:m}=yield this.exchangeCodeForSession(g);if(m)throw m;if(!O.session)throw new Me("No session detected.");let $=new URL(window.location.href);return $.searchParams.delete("code"),window.history.replaceState(window.history.state,"",$.toString()),{data:{session:O.session,redirectType:null},error:null}}const t=I("error_description");if(t){const g=I("error_code");if(!g)throw new M("No error_code detected.");const O=I("error");throw O?new M(t,{error:O,code:g}):new M("No error detected.")}const r=I("provider_token"),n=I("provider_refresh_token"),s=I("access_token");if(!s)throw new M("No access_token detected.");const o=I("expires_in");if(!o)throw new M("No expires_in detected.");const a=I("refresh_token");if(!a)throw new M("No refresh_token detected.");const h=I("token_type");if(!h)throw new M("No token_type detected.");const l=Math.round(Date.now()/1e3)+parseInt(o),{data:u,error:f}=yield this.getUser(s);if(f)throw f;const v=u.user,_={provider_token:r,provider_refresh_token:n,access_token:s,expires_in:parseInt(o),expires_at:l,refresh_token:a,token_type:h,user:v},y=I("type");return window.location.hash="",this._debug("#_getSessionFromUrl()","clearing window.location.hash"),{data:{session:_,redirectType:y},error:null}}catch(t){if(T(t))return{data:{session:null,redirectType:null},error:t};throw t}})}_isImplicitGrantFlow(){return q()&&(!!I("access_token")||!!I("error_description"))}_isPKCEFlow(){return b(this,void 0,void 0,function*(){const e=yield me(this.storage,`${this.storageKey}-code-verifier`);return!!I("code")&&!!e})}signOut(){var e;return b(this,void 0,void 0,function*(){const{data:t,error:r}=yield this.getSession();if(r)return{error:r};const n=(e=t.session)===null||e===void 0?void 0:e.access_token;if(n){const{error:s}=yield this.admin.signOut(n);if(s&&!(Li(s)&&(s.status===404||s.status===401)))return{error:s}}return yield this._removeSession(),yield Fe(this.storage,`${this.storageKey}-code-verifier`),yield this._notifyAllSubscribers("SIGNED_OUT",null),{error:null}})}onAuthStateChange(e){const t=ji(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),this._emitInitialSession(t),{data:{subscription:r}}}_emitInitialSession(e){var t,r;return b(this,void 0,void 0,function*(){try{const{data:{session:n},error:s}=yield this.getSession();if(s)throw s;yield(t=this.stateChangeEmitters.get(e))===null||t===void 0?void 0:t.callback("INITIAL_SESSION",n),this._debug("INITIAL_SESSION","callback id",e,"session",n)}catch(n){yield(r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",null),this._debug("INITIAL_SESSION","callback id",e,"error",n),console.error(n)}})}resetPasswordForEmail(e,t={}){return b(this,void 0,void 0,function*(){let r=null,n=null;if(this.flowType==="pkce"){const s=be();yield ae(this.storage,`${this.storageKey}-code-verifier`,s),r=yield we(s),n=s===r?"plain":"s256"}try{return yield S(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:n,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(s){if(T(s))return{data:null,error:s};throw s}})}_refreshAccessToken(e){return b(this,void 0,void 0,function*(){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return yield Ri(n=>b(this,void 0,void 0,function*(){return yield Pi(n*200),this._debug(t,"refreshing attempt",n),yield S(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:J})}),(n,s,o)=>o&&o.error&&mt(o.error)&&Date.now()+(n+1)*200-r<Se)}catch(r){if(this._debug(t,"error",r),T(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}})}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}_handleProviderSignIn(e,t){return b(this,void 0,void 0,function*(){const r=yield this._getUrlForProvider(e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),q()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}})}_recoverAndRefresh(){var e;return b(this,void 0,void 0,function*(){const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=yield me(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r)){this._debug(t,"session is not valid"),r!==null&&(yield this._removeSession());return}const n=Math.round(Date.now()/1e3),s=((e=r.expires_at)!==null&&e!==void 0?e:1/0)<n+wt;if(this._debug(t,`session has${s?"":" not"} expired with margin of ${wt}s`),s){if(this.autoRefreshToken&&r.refresh_token){const{error:o}=yield this._callRefreshToken(r.refresh_token);o&&(console.error(o),mt(o)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",o),yield this._removeSession()))}}else yield this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(t,"error",r),console.error(r);return}finally{this._debug(t,"end")}})}_callRefreshToken(e){var t,r;return b(this,void 0,void 0,function*(){if(!e)throw new ee;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new Pe;const{data:s,error:o}=yield this._refreshAccessToken(e);if(o)throw o;if(!s.session)throw new ee;yield this._saveSession(s.session),yield this._notifyAllSubscribers("TOKEN_REFRESHED",s.session);const a={session:s.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(s){if(this._debug(n,"error",s),T(s)){const o={session:null,error:s};return(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(s),s}finally{this.refreshingDeferred=null,this._debug(n,"end")}})}_notifyAllSubscribers(e,t,r=!0){return b(this,void 0,void 0,function*(){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const s=[],o=Array.from(this.stateChangeEmitters.values()).map(a=>b(this,void 0,void 0,function*(){try{yield a.callback(e,t)}catch(h){s.push(h)}}));if(yield Promise.all(o),s.length>0){for(let a=0;a<s.length;a+=1)console.error(s[a]);throw s[0]}}finally{this._debug(n,"end")}})}_saveSession(e){return b(this,void 0,void 0,function*(){this._debug("#_saveSession()",e),this.persistSession||(this.inMemorySession=e),this.persistSession&&e.expires_at&&(yield this._persistSession(e))})}_persistSession(e){return this._debug("#_persistSession()",e),ae(this.storage,this.storageKey,e)}_removeSession(){return b(this,void 0,void 0,function*(){this._debug("#_removeSession()"),this.persistSession?yield Fe(this.storage,this.storageKey):this.inMemorySession=null})}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&q()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}_startAutoRefresh(){return b(this,void 0,void 0,function*(){yield this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Se);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),yield this._autoRefreshTokenTick()})}_stopAutoRefresh(){return b(this,void 0,void 0,function*(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)})}startAutoRefresh(){return b(this,void 0,void 0,function*(){this._removeVisibilityChangedCallback(),yield this._startAutoRefresh()})}stopAutoRefresh(){return b(this,void 0,void 0,function*(){this._removeVisibilityChangedCallback(),yield this._stopAutoRefresh()})}_autoRefreshTokenTick(){return b(this,void 0,void 0,function*(){this._debug("#_autoRefreshTokenTick()","begin");try{const e=Date.now();try{const{data:{session:t}}=yield this.getSession();if(!t||!t.refresh_token||!t.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const r=Math.floor((t.expires_at*1e3-e)/Se);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts ${Se}ms, refresh threshold is ${St} ticks`),r<=St&&(yield this._callRefreshToken(t.refresh_token))}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}_handleVisibilityChange(){return b(this,void 0,void 0,function*(){if(this._debug("#_handleVisibilityChange()"),!q()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=()=>b(this,void 0,void 0,function*(){return yield this._onVisibilityChanged(!1)}),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),yield this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}})}_onVisibilityChanged(e){return b(this,void 0,void 0,function*(){this._debug(`#_onVisibilityChanged(${e})`,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(e||(yield this.initializePromise,yield this._recoverAndRefresh(),this._debug("#_onVisibilityChanged()","finished waiting for initialize, _recoverAndRefresh")),this.autoRefreshToken&&this._startAutoRefresh()):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()})}_getUrlForProvider(e,t){return b(this,void 0,void 0,function*(){const r=[`provider=${encodeURIComponent(e)}`];if(t!=null&&t.redirectTo&&r.push(`redirect_to=${encodeURIComponent(t.redirectTo)}`),t!=null&&t.scopes&&r.push(`scopes=${encodeURIComponent(t.scopes)}`),this.flowType==="pkce"){const n=be();yield ae(this.storage,`${this.storageKey}-code-verifier`,n);const s=yield we(n),o=n===s?"plain":"s256";this._debug("PKCE","code verifier",`${n.substring(0,5)}...`,"code challenge",s,"method",o);const a=new URLSearchParams({code_challenge:`${encodeURIComponent(s)}`,code_challenge_method:`${encodeURIComponent(o)}`});r.push(a.toString())}if(t!=null&&t.queryParams){const n=new URLSearchParams(t.queryParams);r.push(n.toString())}return`${this.url}/authorize?${r.join("&")}`})}_unenroll(e){var t;return b(this,void 0,void 0,function*(){try{const{data:r,error:n}=yield this.getSession();return n?{data:null,error:n}:yield S(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(t=r==null?void 0:r.session)===null||t===void 0?void 0:t.access_token})}catch(r){if(T(r))return{data:null,error:r};throw r}})}_enroll(e){var t,r;return b(this,void 0,void 0,function*(){try{const{data:n,error:s}=yield this.getSession();if(s)return{data:null,error:s};const{data:o,error:a}=yield S(this.fetch,"POST",`${this.url}/factors`,{body:{friendly_name:e.friendlyName,factor_type:e.factorType,issuer:e.issuer},headers:this.headers,jwt:(t=n==null?void 0:n.session)===null||t===void 0?void 0:t.access_token});return a?{data:null,error:a}:(!((r=o==null?void 0:o.totp)===null||r===void 0)&&r.qr_code&&(o.totp.qr_code=`data:image/svg+xml;utf-8,${o.totp.qr_code}`),{data:o,error:null})}catch(n){if(T(n))return{data:null,error:n};throw n}})}_verify(e){var t;return b(this,void 0,void 0,function*(){try{const{data:r,error:n}=yield this.getSession();if(n)return{data:null,error:n};const{data:s,error:o}=yield S(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(t=r==null?void 0:r.session)===null||t===void 0?void 0:t.access_token});return o?{data:null,error:o}:(yield this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+s.expires_in},s)),yield this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",s),{data:s,error:o})}catch(r){if(T(r))return{data:null,error:r};throw r}})}_challenge(e){var t;return b(this,void 0,void 0,function*(){try{const{data:r,error:n}=yield this.getSession();return n?{data:null,error:n}:yield S(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{headers:this.headers,jwt:(t=r==null?void 0:r.session)===null||t===void 0?void 0:t.access_token})}catch(r){if(T(r))return{data:null,error:r};throw r}})}_challengeAndVerify(e){return b(this,void 0,void 0,function*(){const{data:t,error:r}=yield this._challenge({factorId:e.factorId});return r?{data:null,error:r}:yield this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})})}_listFactors(){return b(this,void 0,void 0,function*(){const{data:{user:e},error:t}=yield this.getUser();if(t)return{data:null,error:t};const r=(e==null?void 0:e.factors)||[],n=r.filter(s=>s.factor_type==="totp"&&s.status==="verified");return{data:{all:r,totp:n},error:null}})}_getAuthenticatorAssuranceLevel(){var e,t;return b(this,void 0,void 0,function*(){const{data:{session:r},error:n}=yield this.getSession();if(n)return{data:null,error:n};if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const s=this._decodeJWT(r.access_token);let o=null;s.aal&&(o=s.aal);let a=o;((t=(e=r.user.factors)===null||e===void 0?void 0:e.filter(l=>l.status==="verified"))!==null&&t!==void 0?t:[]).length>0&&(a="aal2");const c=s.amr||[];return{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:c},error:null}})}}ge.nextInstanceID=0;class es extends ge{constructor(e){super(e)}}var ts=globalThis&&globalThis.__awaiter||function(i,e,t,r){function n(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(l){try{c(r.next(l))}catch(u){o(u)}}function h(l){try{c(r.throw(l))}catch(u){o(u)}}function c(l){l.done?s(l.value):n(l.value).then(a,h)}c((r=r.apply(i,e||[])).next())})};const rs={headers:bi},is={schema:"public"},ss={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},ns={};class os{constructor(e,t,r){var n,s,o,a,h,c,l,u;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const f=ki(e);this.realtimeUrl=`${f}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${f}/auth/v1`,this.storageUrl=`${f}/storage/v1`,this.functionsUrl=`${f}/functions/v1`;const v=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,_={db:is,realtime:ns,auth:Object.assign(Object.assign({},ss),{storageKey:v}),global:rs},y=Ei(r??{},_);this.storageKey=(s=(n=y.auth)===null||n===void 0?void 0:n.storageKey)!==null&&s!==void 0?s:"",this.headers=(a=(o=y.global)===null||o===void 0?void 0:o.headers)!==null&&a!==void 0?a:{},this.auth=this._initSupabaseAuthClient((h=y.auth)!==null&&h!==void 0?h:{},this.headers,(c=y.global)===null||c===void 0?void 0:c.fetch),this.fetch=Oi(t,this._getAccessToken.bind(this),(l=y.global)===null||l===void 0?void 0:l.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},y.realtime)),this.rest=new Er(`${f}/rest/v1`,{headers:this.headers,schema:(u=y.db)===null||u===void 0?void 0:u.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new yr(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new yi(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}rpc(e,t={},r){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return ts(this,void 0,void 0,function*(){const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,storageKey:s,flowType:o},a,h){const c={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new es({url:this.authUrl,headers:Object.assign(Object.assign({},c),a),storageKey:s,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,flowType:o,fetch:h})}_initRealtimeClient(e){return new ai(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?(this.realtime.setAuth(r??null),this.changedAccessToken=r):e==="SIGNED_OUT"&&(this.realtime.setAuth(this.supabaseKey),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const as=(i,e,t)=>new os(i,e,t),ls="https://xdwrfggkuhgfradlmndf.supabase.co",cs="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhkd3JmZ2drdWhnZnJhZGxtbmRmIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTY4ODI0ODQ5NywiZXhwIjoyMDAzODI0NDk3fQ.b1zhbwkbKC6-8TuiWhW2csBbDZrN6mZkqKics8srzPc",hs=as(ls,cs);function Ot(i,e,t){const r=i.slice();return r[7]=e[t],r[9]=t,r}function kt(i,e,t){const r=i.slice();return r[7]=e[t],r[9]=t,r}function Et(i){let e,t,r,n,s,o,a,h=i[3](i[7].cost)+"",c,l;return{c(){e=N("div"),t=N("img"),s=ce(),o=N("div"),a=ke("$"),c=ke(h),l=ce(),nt(t.src,r=i[7].img_src)||C(t,"src",r),C(t,"alt",n=i[7].title),C(t,"class","svelte-1b5qa05"),C(o,"class","cost svelte-1b5qa05"),C(e,"class","fullscreen item svelte-1b5qa05"),C(e,"id",i[9]+1)},m(u,f){Xe(u,e,f),R(e,t),R(e,s),R(e,o),R(o,a),R(o,c),R(e,l)},p(u,f){f&1&&!nt(t.src,r=u[7].img_src)&&C(t,"src",r),f&1&&n!==(n=u[7].title)&&C(t,"alt",n),f&1&&h!==(h=u[3](u[7].cost)+"")&&xt(c,h)},d(u){u&&$e(e)}}}function $t(i){let e,t,r=i[7].title+"",n;return{c(){e=N("a"),t=N("li"),n=ke(r),C(t,"class","svelte-1b5qa05"),C(e,"data-id",i[9]+1),C(e,"href","#"+(i[9]+1)),C(e,"class","svelte-1b5qa05")},m(s,o){Xe(s,e,o),R(e,t),R(t,n)},p(s,o){o&1&&r!==(r=s[7].title+"")&&xt(n,r)},d(s){s&&$e(e)}}}function us(i){let e,t,r,n,s,o,a,h,c,l,u,f=i[0],v=[];for(let g=0;g<f.length;g+=1)v[g]=Et(kt(i,f,g));let _=i[0],y=[];for(let g=0;g<_.length;g+=1)y[g]=$t(Ot(i,_,g));return{c(){e=N("main"),t=N("header"),t.innerHTML='<div class="logo svelte-1b5qa05">Things I Want</div>',r=ce(),n=N("div");for(let g=0;g<v.length;g+=1)v[g].c();s=ce(),o=N("footer"),o.innerHTML=`<div class="contact svelte-1b5qa05"><a href="mailto:hello@jiieu.com" class="svelte-1b5qa05">hello@jiieu.com</a></div> 
      <div class="copyright svelte-1b5qa05">@ 2023 Jii Eu</div>`,a=ce(),h=N("nav"),c=N("ul");for(let g=0;g<y.length;g+=1)y[g].c();C(t,"class","svelte-1b5qa05"),C(n,"class","main svelte-1b5qa05"),C(o,"class","svelte-1b5qa05"),C(h,"class","svelte-1b5qa05")},m(g,O){Xe(g,e,O),R(e,t),R(e,r),R(e,n);for(let m=0;m<v.length;m+=1)v[m]&&v[m].m(n,null);i[4](n),R(e,s),R(e,o),R(e,a),R(e,h),R(h,c);for(let m=0;m<y.length;m+=1)y[m]&&y[m].m(c,null);l||(u=Wt(n,"scroll",i[2]),l=!0)},p(g,[O]){if(O&9){f=g[0];let m;for(m=0;m<f.length;m+=1){const $=kt(g,f,m);v[m]?v[m].p($,O):(v[m]=Et($),v[m].c(),v[m].m(n,null))}for(;m<v.length;m+=1)v[m].d(1);v.length=f.length}if(O&1){_=g[0];let m;for(m=0;m<_.length;m+=1){const $=Ot(g,_,m);y[m]?y[m].p($,O):(y[m]=$t($),y[m].c(),y[m].m(c,null))}for(;m<y.length;m+=1)y[m].d(1);y.length=_.length}},i:fe,o:fe,d(g){g&&$e(e),ot(v,g),i[4](null),ot(y,g),l=!1,u()}}}function ds(i,e,t){let r=[],n,s=1;Zt(()=>{o().then(l=>t(0,r=Array.from(l))),s=document.body.clientHeight});async function o(){const{data:l,error:u}=await hs.from("Item").select("id, title, img_src, bg_color, cost").order("title");if(u)console.error("error");else return l}const a=l=>{let u=Math.round(n.scrollTop/s)+1;const f=document.querySelector(`[data-id="${u-1}"]`),v=document.querySelector(`[data-id="${u}"]`),_=document.querySelector(`[data-id="${u+1}"]`);document.querySelector(".main").style.backgroundColor=`${r[u-1].bg_color}`,u==1?(v.classList.add("active"),_.classList.remove("active")):u>1&&u<r.length?(f.classList.remove("active"),v.classList.add("active"),_.classList.remove("active")):u===r.length&&(f.classList.remove("active"),v.classList.add("active"))},h=l=>l.toLocaleString("en-us");function c(l){qe[l?"unshift":"push"](()=>{n=l,t(1,n)})}return[r,n,a,h,c]}class fs extends cr{constructor(e){super(),lr(this,e,ds,us,Kt,{})}}new fs({target:document.getElementById("app")});
